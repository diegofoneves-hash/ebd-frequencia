<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Frequência - Nova Parque José Bonifácio</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Frequência EBD">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    <!-- Theme Color -->
    <meta name="theme-color" content="#3498db" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#1a1a2e" media="(prefers-color-scheme: dark)">
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(reg => console.log('Service Worker registrado:', reg))
                .catch(err => console.error('Erro ao registrar Service Worker:', err));
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-church"></i>
                    <div>
                        <h1>Sistema de Frequência - EBD</h1>
                        <p>Controle de presença simples e responsivo</p>
                    </div>
                </div>
                <div class="date-display">
                    <div id="current-date">Carregando data...</div>
                    <div id="current-time">Carregando hora...</div>
                </div>

                <!-- No header, após o date-display -->
                <div class="theme-toggle">
                    <input type="checkbox" id="theme-switch">
                    <label for="theme-switch" class="theme-slider">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </label>
                </div>

            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="attendance">
                <i class="fas fa-clipboard-check"></i> Registrar Presença
            </div>
            <div class="tab" data-tab="members">
                <i class="fas fa-users"></i> Lista de Membros
            </div>
            <div class="tab" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Relatórios
            </div>
            <div class="tab" data-tab="classes">
                <i class="fas fa-chalkboard-teacher"></i> Turmas
            </div>
            <div class="tab" data-tab="add-member">
                <i class="fas fa-user-plus"></i> Adicionar Membro
            </div>
            <div class="tab" data-tab="settings">
                <i class="fas fa-cog"></i> Configurações
            </div>
        </div>
        
        <!-- Aba de Registrar Presença -->
        <div id="attendance" class="tab-content active">
            <div class="section-title">
                <h2><i class="fas fa-clipboard-check"></i> Registrar Presença</h2>
                <div>
                    <button class="btn btn-outline" id="reset-all">
                        <i class="fas fa-redo"></i> Limpar Registros da Data
                    </button>
                </div>
            </div>
            
            <div class="attendance-controls">
                <div class="time-control">
                    <h3>Data da Aula</h3>
                    <div style="text-align: center; margin: 15px 0;">
                        <input type="date" id="attendance-date" class="form-control" 
                            style="font-size: 1.2rem; padding: 10px; text-align: center;" 
                            value="">
                    </div>
                    <div class="tolerance-info">
                        <i class="fas fa-calendar-alt"></i> 
                        <span id="date-status">Selecione a data da aula</span>
                    </div>
                </div>
                
                <div class="time-control">
                    <h3>Informações</h3>
                    <div class="current-time" style="color: var(--secondary); font-size: 1.5rem; margin: 15px 0;">
                        <i class="fas fa-info-circle"></i> Registre presença para qualquer data
                    </div>
                    <div id="tolerance-status" class="tolerance-info">
                        <i class="fas fa-check-circle" style="color: var(--success);"></i> 
                        <span>Data selecionada: <span id="selected-date-display">Hoje</span></span>
                    </div>
                </div>
            </div>
            
            <div class="filter-controls">
                <div class="form-group">
                    <label for="filter-class">Filtrar por Turma:</label>
                    <select id="filter-class" class="form-control">
                        <option value="">Todas as turmas</option>
                        <!-- Turmas serão carregadas dinamicamente via API -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="search-member">Buscar Membro:</label>
                    <input type="text" id="search-member" class="form-control" placeholder="Digite para buscar...">
                </div>
            </div>
            
            <div class="section-title">
                <h3><i class="fas fa-list"></i> Lista de Membros</h3>
                <div>
                    <button class="btn btn-primary" id="mark-all-present">
                        <i class="fas fa-check-circle"></i> Marcar Todos como Presentes
                    </button>
                </div>
            </div>
            
            <div class="members-list" id="attendance-list">
                <!-- Lista de membros será carregada aqui -->
            </div>
        </div>
        
        <!-- Aba de Lista de Membros -->
        <div id="members" class="tab-content">
            <div class="section-title">
                <h2><i class="fas fa-users"></i> Lista de Membros Cadastrados</h2>
                <div class="member-actions">
                    <div class="member-controls">
                        <button class="btn btn-primary" id="add-multiple">
                            <i class="fas fa-user-plus"></i> Adicionar Vários
                        </button>
                        <button class="btn btn-outline" id="export-members">
                            <i class="fas fa-download"></i> Exportar Lista
                        </button>
                        <button class="btn btn-outline" id="refresh-members">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                    
                    <div class="member-filters">
                        <div class="form-group">
                            <input type="text" id="search-members" class="form-control" 
                                   placeholder="Buscar por nome, telefone ou email...">
                        </div>
                        <div class="form-group">
                            <select id="filter-members-class" class="form-control">
                                <option value="">Todas as turmas</option>
                                <!-- Turmas serão carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="form-group">
                            <select id="filter-members-status" class="form-control">
                                <option value="all">Todos os status</option>
                                <option value="active">Ativos</option>
                                <option value="inactive">Inativos</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estatísticas Rápidas -->
            <div class="quick-stats">
                <div class="stat-card">
                    <i class="fas fa-user-check"></i>
                    <span class="stat-count" id="active-members-count">0</span>
                    <span class="stat-label">Ativos</span>
                </div>
                <div class="stat-card">
                    <i class="fas fa-user-times"></i>
                    <span class="stat-count" id="inactive-members-count">0</span>
                    <span class="stat-label">Inativos</span>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <span class="stat-count" id="total-members-count">0</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="stat-card">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span class="stat-count" id="unique-classes-count">0</span>
                    <span class="stat-label">Turmas</span>
                </div>
            </div>
            
            <!-- Lista de Membros -->
            <div class="members-list" id="members-list">
                <!-- Lista completa de membros será carregada aqui -->
            </div>
            
            <!-- Paginação (opcional para muitos membros) -->
            <div class="pagination" id="members-pagination" style="display: none;">
                <button class="btn btn-outline" id="prev-page">
                    <i class="fas fa-chevron-left"></i> Anterior
                </button>
                <span class="page-info">Página <span id="current-page">1</span> de <span id="total-pages">1</span></span>
                <button class="btn btn-outline" id="next-page">
                    Próxima <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Aba de Relatórios -->
        <div id="reports" class="tab-content">
            <div class="section-title">
                <h2><i class="fas fa-chart-bar"></i> Relatório de Frequência</h2>
                <div class="report-actions">
                    <div class="report-controls">
                        <select id="report-period" class="form-control">
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month">Este Mês</option>
                            <option value="all">Todo Período</option>
                        </select>
                        
                        <div class="export-btn-group">
                            <button class="btn btn-outline" id="export-pdf-btn" title="Exportar para PDF">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline" id="export-excel-btn" title="Exportar para Excel">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                            <button class="btn btn-outline" id="export-chart-btn" title="Exportar Gráfico">
                                <i class="fas fa-chart-bar"></i> Gráfico
                            </button>
                            <button class="btn btn-primary" id="export-report" title="Exportar Relatório Completo">
                                <i class="fas fa-file-export"></i> Exportar Relatório
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filtros Avançados -->
            <div class="advanced-filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="class-filter"><i class="fas fa-filter"></i> Filtro por Turma:</label>
                        <select id="class-filter" class="form-control">
                            <option value="all">Todas as Turmas</option>
                            <!-- Turmas serão carregadas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="date-range"><i class="fas fa-calendar-alt"></i> Período:</label>
                        <div class="date-range-inputs">
                            <input type="date" id="start-date" class="form-control" value="2024-01-01">
                            <span>até</span>
                            <input type="date" id="end-date" class="form-control" value="2024-12-31">
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-chart-pie"></i> Tipo de Relatório:</label>
                        <select id="report-type" class="form-control">
                            <option value="summary">Resumo Geral</option>
                            <option value="detailed">Detalhado</option>
                            <option value="comparative">Comparativo</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-primary" id="apply-filters">
                            <i class="fas fa-play"></i> Aplicar Filtros
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Resumo em Cards -->
            <div class="summary-cards" id="report-summary">
                <!-- Resumo será carregado aqui -->
            </div>
            
            <!-- Gráficos -->
            <div class="section-title">
                <h3><i class="fas fa-chart-line"></i> Gráficos de Análise</h3>
                <div class="chart-controls">
                    <button class="btn btn-outline" id="refresh-charts">
                        <i class="fas fa-sync-alt"></i> Atualizar Gráficos
                    </button>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-box">
                    <canvas id="attendanceTrendChart"></canvas>
                    <p class="chart-title">Evolução de Presença (Últimos 7 dias)</p>
                </div>
                <div class="chart-box">
                    <canvas id="classDistributionChart"></canvas>
                    <p class="chart-title">Distribuição por Turma</p>
                </div>
                <div class="chart-box">
                    <canvas id="attendanceRateChart"></canvas>
                    <p class="chart-title">Taxa de Presença por Turma</p>
                </div>
            </div>
            
            <!-- Histórico -->
            <div class="section-title">
                <h3><i class="fas fa-history"></i> Histórico de Presença</h3>
                <div class="history-controls">
                    <button class="btn btn-outline" id="export-history">
                        <i class="fas fa-download"></i> Exportar Histórico
                    </button>
                </div>
            </div>
            
            <div id="attendance-history">
                <!-- Histórico será carregado aqui -->
            </div>
        </div>
        
        <!-- Aba de Turmas -->
        <div id="classes" class="tab-content">
            <div class="section-title">
                <h2><i class="fas fa-chalkboard-teacher"></i> Gerenciamento de Turmas</h2>
                <div>
                    <button class="btn btn-primary" id="add-class-btn">
                        <i class="fas fa-plus"></i> Nova Turma
                    </button>
                </div>
            </div>
            
            <div class="classes-list" id="classes-list">
                <!-- Lista de turmas será carregada aqui -->
            </div>
            
            <div id="class-form-container" style="display: none; margin-top: 30px;">
                <div class="section-title">
                    <h3><i class="fas fa-edit"></i> <span id="form-title">Nova Turma</span></h3>
                </div>
                
                <div class="add-member-form">
                    <div class="form-group">
                        <label for="class-name">Nome da Turma *</label>
                        <input type="text" id="class-name" class="form-control" placeholder="Ex: Adultos, Jovens, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="class-teacher">Professor Responsável</label>
                        <input type="text" id="class-teacher" class="form-control" placeholder="Nome do professor">
                    </div>
                    
                    <div class="form-group">
                        <label for="class-description">Descrição (Opcional)</label>
                        <textarea id="class-description" class="form-control" rows="3" placeholder="Descrição da turma..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="class-room">Sala/Local (Opcional)</label>
                        <input type="text" id="class-room" class="form-control" placeholder="Ex: Sala 1, Templo, etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="class-schedule">Horário (Opcional)</label>
                        <input type="text" id="class-schedule" class="form-control" placeholder="Ex: 09:00 às 10:00">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="class-active" checked> Turma Ativa
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-success" id="save-class">
                            <i class="fas fa-save"></i> Salvar Turma
                        </button>
                        
                        <button class="btn btn-outline" id="cancel-class-form">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        
                        <button class="btn btn-danger" id="delete-class" style="display: none;">
                            <i class="fas fa-trash"></i> Excluir Turma
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Aba de Adicionar Membro -->
        <div id="add-member" class="tab-content">
            <div class="section-title">
                <h2><i class="fas fa-user-plus"></i> Adicionar Novo Membro</h2>
            </div>
            
            <div class="add-member-form">
                <div class="form-group">
                    <label for="member-name">Nome Completo *</label>
                    <input type="text" id="member-name" class="form-control" placeholder="Digite o nome completo">
                </div>
                
                <div class="form-group">
                    <label for="member-class">Turma/Classe (Opcional)</label>
                    <select id="member-class" class="form-control">
                        <option value="">Selecione uma turma</option>
                        <option value="Outra">Outra</option>
                        <!-- Turmas serão carregadas dinamicamente via API -->
                    </select>
                </div>
                
                <div class="form-group" id="custom-class-container" style="display: none;">
                    <label for="custom-class">Nome da Turma</label>
                    <input type="text" id="custom-class" class="form-control" placeholder="Digite o nome da turma">
                </div>
                
                <div class="form-group">
                    <label for="member-phone">Telefone (Opcional)</label>
                    <input type="text" id="member-phone" class="form-control" placeholder="(00) 00000-0000">
                </div>
                
                <div class="form-group">
                    <label for="member-email">Email (Opcional)</label>
                    <input type="email" id="member-email" class="form-control" placeholder="email@exemplo.com">
                </div>
                
                <div class="form-group">
                    <label for="member-birthdate">Data de Nascimento (Opcional)</label>
                    <input type="date" id="member-birthdate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="member-active" checked> Membro Ativo
                    </label>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-success" id="save-member">
                        <i class="fas fa-save"></i> Salvar Membro
                    </button>
                    
                    <button class="btn btn-outline" id="clear-form">
                        <i class="fas fa-eraser"></i> Limpar Formulário
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Aba de Configurações -->
        <div id="settings" class="tab-content">
            <div class="section-title">
                <h2><i class="fas fa-cog"></i> Configurações do Sistema</h2>
            </div>
            
            <div class="settings-form">
                
                <div class="form-group">
                    <h3><i class="fas fa-database"></i> Gerenciamento de Dados</h3>
                    
                    <div class="data-actions">
                        <button class="btn btn-outline" id="backup-data">
                            <i class="fas fa-download"></i> Fazer Backup
                        </button>
                        <button class="btn btn-outline" id="restore-data">
                            <i class="fas fa-upload"></i> Restaurar Backup
                        </button>
                        <button class="btn btn-danger" id="clear-data">
                            <i class="fas fa-trash"></i> Limpar Todos os Dados
                        </button>
                    </div>
                    
                    <div class="data-info">
                        <p><strong>Informações do Banco de Dados:</strong></p>
                        <p id="db-info">Carregando informações...</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <h3><i class="fas fa-info-circle"></i> Sobre o Sistema</h3>
                    <p>Versão: 2.0.0</p>
                    <p>Sistema de Frequência para EBD - Desenvolvido para controle de presença aos domingos</p>
                    <p>Os dados são armazenados localmente no seu navegador usando SQLite</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Sistema de Frequência para EBD &copy; <span id="current-year">2024</span> | Desenvolvido por Avode Sistemas</p>
            <p>Os dados são armazenados localmente no seu navegador</p>
        </div>
    </div>

    <!-- Modal para adicionar múltiplos membros -->
    <div id="multi-member-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> Adicionar Múltiplos Membros</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Digite os nomes dos membros, um por linha:</p>
                <textarea id="multi-member-names" rows="10" placeholder="João Silva
Maria Santos
Pedro Oliveira
..."></textarea>
                <div class="form-group">
                    <label for="multi-member-class">Turma para todos:</label>
                    <select id="multi-member-class" class="form-control">
                        <option value="">Selecione uma turma</option>
                        <!-- Turmas serão carregadas dinamicamente via API -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="save-multi-members">
                    <i class="fas fa-save"></i> Salvar Membros
                </button>
                <button class="btn btn-outline close-modal">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/animations.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/offline.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/export.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>